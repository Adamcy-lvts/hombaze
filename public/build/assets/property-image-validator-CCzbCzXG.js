class p{constructor(){this.config={minWidth:1024,minHeight:683,recommendedWidth:1440,recommendedHeight:960,maxFileSizeMB:5,allowedTypes:["image/jpeg","image/png","image/webp"],aspectRatio:3/2,aspectTolerance:.15},this.propertyTypeConfigs={apartment:{maxFiles:10,type:"apartment"},house:{maxFiles:10,type:"house"},land:{maxFiles:4,type:"land"},commercial:{maxFiles:5,type:"commercial"},"office-space":{maxFiles:8,type:"office space"},warehouse:{maxFiles:6,type:"warehouse"}},this.init()}init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.attachValidators()):this.attachValidators()}attachValidators(){this.attachToFileInputs(),this.listenForPropertyTypeChanges()}attachToFileInputs(){document.querySelectorAll('input[type="file"][accept*="image"]').forEach(e=>{(e.closest('[data-field-wrapper="featured_image"]')||e.closest('[data-field-wrapper="gallery_images"]'))&&e.addEventListener("change",i=>{this.validateFiles(i.target.files,e)})})}listenForPropertyTypeChanges(){const t=document.querySelector('select[name="property_type_id"]');t&&t.addEventListener("change",e=>{this.updateValidationMessages()})}async validateFiles(t,e){var l;const i=[],a=[],s=Array.from(t).map((o,d)=>Promise.resolve(this.validateSingleFile(o)).then(c=>({result:c,file:o,index:d})));if((await Promise.all(s)).forEach(({result:o,file:d,index:c})=>{o.valid?i.push({file:d,meta:o}):a.push(`File ${c+1}: ${o.error}`)}),a.length>0){this.showValidationErrors(a,e),e.value="";return}this.clearValidationErrors(e),this.showSuccessMessage(i.map(({file:o})=>o),e);const r=(l=i[0])==null?void 0:l.meta;r!=null&&r.width&&(r!=null&&r.height)&&this.showDimensionInfo(r.width,r.height,r.sizeMB,e)}validateSingleFile(t){if(!this.config.allowedTypes.includes(t.type))return{valid:!1,error:"üì∑ Please upload a valid image file (JPEG, PNG, or WebP)"};const e=t.size/(1024*1024);return e>this.config.maxFileSizeMB?{valid:!1,error:`üìè Image is too large (${e.toFixed(1)}MB). Maximum: ${this.config.maxFileSizeMB}MB`}:new Promise(i=>{const a=new Image;a.onload=()=>{const s=this.validateDimensions(a.width,a.height,t.name);i({...s,width:a.width,height:a.height,sizeMB:e})},a.onerror=()=>{i({valid:!1,error:"‚ùå Invalid image file - unable to read image dimensions"})},a.src=URL.createObjectURL(t)})}validateDimensions(t,e,i){if(t<this.config.minWidth||e<this.config.minHeight)return{valid:!1,error:`üìê Image resolution too low. Minimum: ${this.config.minWidth}√ó${this.config.minHeight}px. Your image: ${t}√ó${e}px`};const a=t/e,s=this.config.aspectRatio;if(Math.abs(a-s)>this.config.aspectTolerance){const n=Math.round(e*s),r=Math.round(t/s);console.info(`Image aspect ratio notice: ${i} (${t}√ó${e}) - optimal dimensions would be ${n}√ó${e} or ${t}√ó${r}`)}return{valid:!0}}showValidationErrors(t,e){this.clearValidationErrors(e);const i=e.closest("[data-field-wrapper]");if(!i)return;const a=document.createElement("div");if(a.className="property-image-validation-errors mt-2 p-4 bg-red-50 border-2 border-red-300 rounded-lg shadow-xs",a.style.animation="shake 0.6s ease-in-out",a.innerHTML=`
            <div class="flex items-start">
                <div class="text-red-500 shrink-0 mr-3">
                    <svg class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="flex-1">
                    <div class="text-sm font-semibold text-red-800 mb-2">‚ùå Upload Failed - Image Requirements Not Met</div>
                    <ul class="text-sm text-red-700 space-y-2">
                        ${t.map(s=>`<li class="flex items-start"><span class="text-red-400 mr-2">‚Ä¢</span><span>${s}</span></li>`).join("")}
                    </ul>
                    <div class="mt-3 p-2 bg-red-100 rounded-sm text-xs text-red-600">
                        <strong>üí° Quick Fix:</strong> Use images at least ${this.config.minWidth}√ó${this.config.minHeight}px, under ${this.config.maxFileSizeMB}MB, in JPEG/PNG/WebP format.
                    </div>
                </div>
            </div>
        `,i.appendChild(a),setTimeout(()=>{a.scrollIntoView({behavior:"smooth",block:"nearest"})},100),"Audio"in window)try{const s=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmAaBDaN0e/adyEELYPR8Ni9oCUGI1mr5+OVSA0PVqzn77BdGAg+ltryxnkpBSl+zfPrfyUDEUSe0vPpbSMBADJ30s3PwDNOQwgWe8bq3IVHaB9kAUqGxhY=");s.volume=.3,s.play().catch(()=>{})}catch{}}clearValidationErrors(t){const e=t.closest("[data-field-wrapper]");if(!e)return;e.querySelectorAll(".property-image-validation-errors, .property-image-validation-success, .property-image-dimension-info").forEach(a=>a.remove())}showSuccessMessage(t,e){const i=e.closest("[data-field-wrapper]");if(!i||t.length===0)return;const a=document.createElement("div");a.className="property-image-validation-success mt-2 p-2 bg-green-50 border border-green-200 rounded-md",a.innerHTML=`
            <div class="flex items-center text-sm text-green-700">
                <svg class="h-4 w-4 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <span>‚úÖ ${t.length} image${t.length>1?"s":""} validated successfully</span>
            </div>
        `,i.appendChild(a),setTimeout(()=>{a.parentNode&&a.remove()},3e3)}showDimensionInfo(t,e,i,a){const s=a.closest("[data-field-wrapper]");if(!s)return;const n=(t/e).toFixed(2),r=Math.abs(t/e-this.config.aspectRatio)<=this.config.aspectTolerance,l=t>=this.config.recommendedWidth&&e>=this.config.recommendedHeight,o=document.createElement("div");o.className="property-image-dimension-info mt-2 p-2 bg-blue-50 border border-blue-200 rounded-md",o.innerHTML=`
            <div class="text-xs text-blue-700">
                <div class="flex items-center justify-between">
                    <span>üìè ${t}√ó${e}px (${n}:1) ‚Ä¢ ${i.toFixed(1)}MB</span>
                    <div class="flex space-x-1">
                        ${l?'<span class="text-green-600">‚≠ê High Res</span>':'<span class="text-orange-600">‚ö†Ô∏è Low Res</span>'}
                        ${r?'<span class="text-green-600">üìê Optimal Ratio</span>':'<span class="text-orange-600">üìê Non-optimal Ratio</span>'}
                    </div>
                </div>
            </div>
        `,s.appendChild(o),setTimeout(()=>{o.parentNode&&o.remove()},5e3)}updateValidationMessages(){const t=document.querySelector('select[name="property_type_id"]');if(!t)return;const e=t.options[t.selectedIndex];(e==null?void 0:e.value)&&console.log("Property type changed, validation limits may have updated")}}document.addEventListener("DOMContentLoaded",function(){new p});window.PropertyImageValidator=p;
